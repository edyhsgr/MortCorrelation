# created 29 Sep 18
# altered 29 Sep 18
#
# visualize remaining life expectancy
#---------------------------------------------
rm(list=ls())
library(tidyverse)
graphics.off()
if (.Platform$OS.type == 'windows') windows(record=TRUE, width=8, height=8)
## California females 2015
file_name = 'CA_fltper_1x1.csv'
file_path = 'States/CA/CA_fltper_1x1.csv'
unzip(zipfile='lifetables.zip', files=file_path, junkpaths=TRUE)
df = read.csv(file_name, stringsAsFactors = FALSE) %>%
filter(Year == 2015) %>%
mutate(Age = 0:110,
lx = lx/lx[Age==0]) %>%
select(PopName:Age, lx, ex)
# add one row
extra_row = df[nrow(df),]
extra_row$Age = 111
extra_row$lx  = 0
df = rbind(df, extra_row)
file.remove(file_name)
## make plot
make_ex_plot = function(x) {
remaining_life = df %>%
mutate(lx = ifelse(Age < x, NA, lx/lx[Age==x]))
conditional_surv = df %>%
mutate(lx = ifelse(Age < x, 1, lx/lx[Age==x]))
this.ex = df$ex[df$Age == x]
box = expand.grid( lx=c(0,1) , Age=c(x,x+this.ex) )[c(1,2,4,3),]
boxtop = filter(box,lx==1)
G = ggplot( data=df, aes(x=Age, y=lx)) +
geom_line(lwd=0.5, color='royalblue') +
geom_hline(yintercept = 0) +
theme_bw()
G = G +
geom_line(data=conditional_surv, col='red', lwd=1.2) +
geom_area(data=remaining_life, fill='pink', color='red',alpha=.60) +
geom_polygon(data=box, fill='grey', alpha=.40) +
labs(title= paste0('e(',x,') = ', this.ex)) +
geom_line(data=boxtop, lwd=1.5, color='black',
arrow=arrow(length=unit(.10,'inches'))) +
geom_text(x=x+this.ex, y=1, label=this.ex)
print(G)
}
for (x in 0:100) make_ex_plot(x)
#---------------------------------------------
# Carl Schmertmann
# created 29 Sep 18
# altered 29 Sep 18
#
# visualize remaining life expectancy
#---------------------------------------------
rm(list=ls())
library(tidyverse)
graphics.off()
if (.Platform$OS.type == 'windows') windows(record=TRUE, width=8, height=8)
## California females 2015
file_name = 'CA_fltper_1x1.csv'
file_path = 'States/CA/CA_fltper_1x1.csv'
unzip(zipfile='lifetables.zip', files=file_path, junkpaths=TRUE)
df = read.csv(file_name, stringsAsFactors = FALSE) %>%
filter(Year == 2015) %>%
mutate(Age = 0:110,
lx = lx/lx[Age==0]) %>%
select(PopName:Age, lx, ex)
# add one row
extra_row = df[nrow(df),]
extra_row$Age = 111
extra_row$lx  = 0
df = rbind(df, extra_row)
file.remove(file_name)
## make plot
make_ex_plot = function(x) {
remaining_life = df %>%
mutate(lx = ifelse(Age < x, NA, lx/lx[Age==x]))
conditional_surv = df %>%
mutate(lx = ifelse(Age < x, 1, lx/lx[Age==x]))
this.ex = df$ex[df$Age == x]
box = expand.grid( lx=c(0,1) , Age=c(x,x+this.ex) )[c(1,2,4,3),]
boxtop = filter(box,lx==1)
G = ggplot( data=df, aes(x=Age, y=lx)) +
geom_line(lwd=0.5, color='royalblue') +
geom_hline(yintercept = 0) +
theme_bw()
G = G +
geom_line(data=conditional_surv, col='red', lwd=1.2) +
geom_area(data=remaining_life, fill='pink', color='red',alpha=.60) +
geom_polygon(data=box, fill='grey', alpha=.40) +
labs(title= paste0('e(',x,') = ', this.ex)) +
geom_line(data=boxtop, lwd=1.5, color='black',
arrow=arrow(length=unit(.10,'inches'))) +
geom_text(x=x+this.ex/2, y=1.05, label=this.ex)
print(G)
}
for (x in 0:100) make_ex_plot(x)
#---------------------------------------------
# Carl Schmertmann
# created 29 Sep 18
# altered 29 Sep 18
#
# visualize remaining life expectancy
#---------------------------------------------
rm(list=ls())
library(tidyverse)
graphics.off()
if (.Platform$OS.type == 'windows') windows(record=TRUE, width=8, height=8)
## California females 2015
file_name = 'CA_fltper_1x1.csv'
file_path = 'States/CA/CA_fltper_1x1.csv'
unzip(zipfile='lifetables.zip', files=file_path, junkpaths=TRUE)
df = read.csv(file_name, stringsAsFactors = FALSE) %>%
filter(Year == 2015) %>%
mutate(Age = 0:110,
lx = lx/lx[Age==0]) %>%
select(PopName:Age, lx, ex)
# add one row
extra_row = df[nrow(df),]
extra_row$Age = 111
extra_row$lx  = 0
df = rbind(df, extra_row)
file.remove(file_name)
## make plot
make_ex_plot = function(x) {
remaining_life = df %>%
mutate(lx = ifelse(Age < x, NA, lx/lx[Age==x]))
conditional_surv = df %>%
mutate(lx = ifelse(Age < x, 1, lx/lx[Age==x]))
this.ex = df$ex[df$Age == x]
box = expand.grid( lx=c(0,1) , Age=c(x,x+this.ex) )[c(1,2,4,3),]
boxtop = filter(box,lx==1)
G = ggplot( data=df, aes(x=Age, y=lx)) +
geom_line(lwd=0.5, color='royalblue') +
geom_hline(yintercept = 0) +
theme_bw()
G = G +
geom_line(data=conditional_surv, col='red', lwd=1.2) +
geom_area(data=remaining_life, fill='pink', color='red',alpha=.60) +
geom_polygon(data=box, fill='grey', alpha=.40) +
labs(title= paste0('e(',x,') = ', this.ex)) +
geom_line(data=boxtop, lwd=1.5, color='black',
arrow=arrow(length=unit(.10,'inches'))) +
geom_text(x=x+this.ex/2, y=1.01, size=8,label=this.ex)
print(G)
}
for (x in 0:100) make_ex_plot(x)
#---------------------------------------------
# Carl Schmertmann
# created 29 Sep 18
# altered 29 Sep 18
#
# visualize remaining life expectancy
#---------------------------------------------
rm(list=ls())
library(tidyverse)
graphics.off()
if (.Platform$OS.type == 'windows') windows(record=TRUE, width=8, height=8)
## California females 2015
file_name = 'CA_fltper_1x1.csv'
file_path = 'States/CA/CA_fltper_1x1.csv'
unzip(zipfile='lifetables.zip', files=file_path, junkpaths=TRUE)
df = read.csv(file_name, stringsAsFactors = FALSE) %>%
filter(Year == 2015) %>%
mutate(Age = 0:110,
lx = lx/lx[Age==0]) %>%
select(PopName:Age, lx, ex)
# add one row
extra_row = df[nrow(df),]
extra_row$Age = 111
extra_row$lx  = 0
df = rbind(df, extra_row)
file.remove(file_name)
## make plot
make_ex_plot = function(x) {
remaining_life = df %>%
mutate(lx = ifelse(Age < x, NA, lx/lx[Age==x]))
conditional_surv = df %>%
mutate(lx = ifelse(Age < x, 1, lx/lx[Age==x]))
this.ex = df$ex[df$Age == x]
box = expand.grid( lx=c(0,1) , Age=c(x,x+this.ex) )[c(1,2,4,3),]
boxtop = filter(box,lx==1)
G = ggplot( data=df, aes(x=Age, y=lx)) +
geom_line(lwd=0.5, color='royalblue') +
geom_hline(yintercept = 0) +
theme_bw()
G = G +
geom_line(data=conditional_surv, col='red', lwd=1.2) +
geom_area(data=remaining_life, fill='pink', color='red',alpha=.60) +
geom_polygon(data=box, fill='grey', alpha=.40) +
labs(title= paste0('e(',x,') = ', this.ex)) +
geom_line(data=boxtop, lwd=1.5, color='black',
arrow=arrow(length=unit(.10,'inches'))) +
geom_text(x=x+this.ex/2, y=1.01, size=3.5,label=this.ex)
print(G)
}
for (x in 0:100) make_ex_plot(x)
#---------------------------------------------
# Carl Schmertmann
# created 29 Sep 18
# altered 29 Sep 18
#
# visualize remaining life expectancy
#---------------------------------------------
rm(list=ls())
library(tidyverse)
graphics.off()
if (.Platform$OS.type == 'windows') windows(record=TRUE, width=8, height=8)
## California females 2015
file_name = 'CA_fltper_1x1.csv'
file_path = 'States/CA/CA_fltper_1x1.csv'
unzip(zipfile='lifetables.zip', files=file_path, junkpaths=TRUE)
df = read.csv(file_name, stringsAsFactors = FALSE) %>%
filter(Year == 2015) %>%
mutate(Age = 0:110,
lx = lx/lx[Age==0]) %>%
select(PopName:Age, lx, ex)
# add one row
extra_row = df[nrow(df),]
extra_row$Age = 111
extra_row$lx  = 0
df = rbind(df, extra_row)
file.remove(file_name)
## make plot
make_ex_plot = function(x) {
remaining_life = df %>%
mutate(lx = ifelse(Age < x, NA, lx/lx[Age==x]))
conditional_surv = df %>%
mutate(lx = ifelse(Age < x, 1, lx/lx[Age==x]))
this.ex = df$ex[df$Age == x]
box = expand.grid( lx=c(0,1) , Age=c(x,x+this.ex) )[c(1,2,4,3),]
boxtop = filter(box,lx==1)
G = ggplot( data=df, aes(x=Age, y=lx)) +
geom_line(lwd=0.5, color='royalblue') +
geom_hline(yintercept = 0) +
theme_bw()
G = G +
geom_line(data=conditional_surv, col='red', lwd=1.2) +
geom_area(data=remaining_life, fill='pink', color='red',alpha=.60) +
geom_polygon(data=box, fill='grey', alpha=.40) +
labs(title= paste0('e(',x,') = ', this.ex)) +
geom_line(data=boxtop, lwd=1.5, color='black',
arrow=arrow(length=unit(.10,'inches'))) +
geom_text(x=x+this.ex/2, y=1.02, size=3.5,label=this.ex)
print(G)
}
for (x in 0:100) make_ex_plot(x)
#---------------------------------------------
# Carl Schmertmann
# created 29 Sep 18
# altered 29 Sep 18
#
# visualize remaining life expectancy
#---------------------------------------------
rm(list=ls())
library(tidyverse)
graphics.off()
if (.Platform$OS.type == 'windows') windows(record=TRUE, width=8, height=8)
## California females 2015
file_name = 'CA_fltper_1x1.csv'
file_path = 'States/CA/CA_fltper_1x1.csv'
unzip(zipfile='lifetables.zip', files=file_path, junkpaths=TRUE)
df = read.csv(file_name, stringsAsFactors = FALSE) %>%
filter(Year == 2015) %>%
mutate(Age = 0:110,
lx = lx/lx[Age==0]) %>%
select(PopName:Age, lx, ex)
# add one row
extra_row = df[nrow(df),]
extra_row$Age = 111
extra_row$lx  = 0
df = rbind(df, extra_row)
file.remove(file_name)
## make plot
make_ex_plot = function(x) {
remaining_life = df %>%
mutate(lx = ifelse(Age < x, NA, lx/lx[Age==x]))
conditional_surv = df %>%
mutate(lx = ifelse(Age < x, 1, lx/lx[Age==x]))
this.ex = df$ex[df$Age == x]
box = expand.grid( lx=c(0,1) , Age=c(x,x+this.ex) )[c(1,2,4,3),]
boxtop = filter(box,lx==1)
G = ggplot( data=df, aes(x=Age, y=lx)) +
geom_line(lwd=0.5, color='royalblue') +
geom_hline(yintercept = 0) +
theme_bw()
G = G +
geom_line(data=conditional_surv, col='red', lwd=1.2) +
geom_area(data=remaining_life, fill='pink', color='red',alpha=.60) +
geom_polygon(data=box, fill='grey', alpha=.40) +
labs(title= paste0('e(',x,') = ', this.ex)) +
geom_line(data=boxtop, lwd=1.5, color='black',
arrow=arrow(length=unit(.10,'inches'))) +
geom_text(x=x+this.ex/2, y=1.03, size=3,label=this.ex)
print(G)
}
for (x in 0:100) make_ex_plot(x)
#---------------------------------------------
# Carl Schmertmann
# created 29 Sep 18
# altered 29 Sep 18
#
# visualize remaining life expectancy
#---------------------------------------------
rm(list=ls())
library(tidyverse)
graphics.off()
if (.Platform$OS.type == 'windows') windows(record=TRUE, width=8, height=8)
## California females 2015
file_name = 'CA_fltper_1x1.csv'
file_path = 'States/CA/CA_fltper_1x1.csv'
unzip(zipfile='lifetables.zip', files=file_path, junkpaths=TRUE)
df = read.csv(file_name, stringsAsFactors = FALSE) %>%
filter(Year == 2015) %>%
mutate(Age = 0:110,
lx = lx/lx[Age==0]) %>%
select(PopName:Age, lx, ex)
# add one row
extra_row = df[nrow(df),]
extra_row$Age = 111
extra_row$lx  = 0
df = rbind(df, extra_row)
file.remove(file_name)
## make plot
make_ex_plot = function(x) {
remaining_life = df %>%
mutate(lx = ifelse(Age < x, NA, lx/lx[Age==x]))
conditional_surv = df %>%
mutate(lx = ifelse(Age < x, 1, lx/lx[Age==x]))
this.ex = df$ex[df$Age == x]
box = expand.grid( lx=c(0,1) , Age=c(x,x+this.ex) )[c(1,2,4,3),]
boxtop = filter(box,lx==1)
G = ggplot( data=df, aes(x=Age, y=lx)) +
geom_line(lwd=0.5, color='royalblue') +
geom_hline(yintercept = 0) +
theme_bw()
G = G +
geom_line(data=conditional_surv, col='red', lwd=1.2) +
geom_area(data=remaining_life, fill='pink', color=NA,alpha=.50) +
geom_polygon(data=box, fill='grey', alpha=.30) +
labs(title= paste0('e(',x,') = ', this.ex)) +
geom_line(data=boxtop, lwd=1.5, color='black',
arrow=arrow(length=unit(.10,'inches'))) +
geom_text(x=x+this.ex/2, y=1.03, size=3,label=this.ex)
print(G)
}
for (x in 0:100) make_ex_plot(x)
?formatC
?prettyNum
df$ex
prettyNum(df$ex)
prettyNum(round(df$ex,1))
formatC(df$ex)
formatC(df$ex, digits=1)
formatC(df$ex, digits=2)
formatC(df$ex, digits=1)
formatC(df$ex, format='f')
formatC(df$ex, format='f', digits=2)
formatC(df$ex, format='f', digits=1)
#---------------------------------------------
# Carl Schmertmann
# created 29 Sep 18
# altered 29 Sep 18
#
# visualize remaining life expectancy
#---------------------------------------------
rm(list=ls())
library(tidyverse)
graphics.off()
if (.Platform$OS.type == 'windows') windows(record=TRUE, width=8, height=8)
## California females 2015
file_name = 'CA_fltper_1x1.csv'
file_path = 'States/CA/CA_fltper_1x1.csv'
unzip(zipfile='lifetables.zip', files=file_path, junkpaths=TRUE)
df = read.csv(file_name, stringsAsFactors = FALSE) %>%
filter(Year == 2015) %>%
mutate(Age = 0:110,
lx = lx/lx[Age==0]) %>%
select(PopName:Age, lx, ex)
# add one row
extra_row = df[nrow(df),]
extra_row$Age = 111
extra_row$lx  = 0
df = rbind(df, extra_row)
file.remove(file_name)
## make plot
make_ex_plot = function(x) {
remaining_life = df %>%
mutate(lx = ifelse(Age < x, NA, lx/lx[Age==x]))
conditional_surv = df %>%
mutate(lx = ifelse(Age < x, 1, lx/lx[Age==x]))
this.ex = formatC( df$ex[df$Age == x], format='f' , digits=1)
box = expand.grid( lx=c(0,1) , Age=c(x,x+this.ex) )[c(1,2,4,3),]
boxtop = filter(box,lx==1)
G = ggplot( data=df, aes(x=Age, y=lx)) +
geom_line(lwd=0.5, color='royalblue') +
geom_hline(yintercept = 0) +
theme_bw()
G = G +
geom_line(data=conditional_surv, col='red', lwd=1.2) +
geom_area(data=remaining_life, fill='pink', color=NA,alpha=.50) +
geom_polygon(data=box, fill='grey', alpha=.30) +
labs(title= paste0('e(',x,') = ', this.ex)) +
geom_line(data=boxtop, lwd=1.5, color='black',
arrow=arrow(length=unit(.10,'inches'))) +
geom_text(x=x+this.ex/2, y=1.03, size=3,label=this.ex)
print(G)
}
for (x in 0:100) make_ex_plot(x)
#---------------------------------------------
# Carl Schmertmann
# created 29 Sep 18
# altered 29 Sep 18
#
# visualize remaining life expectancy
#---------------------------------------------
rm(list=ls())
library(tidyverse)
graphics.off()
if (.Platform$OS.type == 'windows') windows(record=TRUE, width=8, height=8)
## California females 2015
file_name = 'CA_fltper_1x1.csv'
file_path = 'States/CA/CA_fltper_1x1.csv'
unzip(zipfile='lifetables.zip', files=file_path, junkpaths=TRUE)
df = read.csv(file_name, stringsAsFactors = FALSE) %>%
filter(Year == 2015) %>%
mutate(Age = 0:110,
lx = lx/lx[Age==0]) %>%
select(PopName:Age, lx, ex)
# add one row
extra_row = df[nrow(df),]
extra_row$Age = 111
extra_row$lx  = 0
df = rbind(df, extra_row)
file.remove(file_name)
## make plot
make_ex_plot = function(x) {
remaining_life = df %>%
mutate(lx = ifelse(Age < x, NA, lx/lx[Age==x]))
conditional_surv = df %>%
mutate(lx = ifelse(Age < x, 1, lx/lx[Age==x]))
this.ex = df$ex[df$Age == x]
this.ex.char = formatC( df$ex[df$Age == x], format='f' , digits=1)
box = expand.grid( lx=c(0,1) , Age=c(x,x+this.ex) )[c(1,2,4,3),]
boxtop = filter(box,lx==1)
G = ggplot( data=df, aes(x=Age, y=lx)) +
geom_line(lwd=0.5, color='royalblue') +
geom_hline(yintercept = 0) +
theme_bw()
G = G +
geom_line(data=conditional_surv, col='red', lwd=1.2) +
geom_area(data=remaining_life, fill='pink', color=NA,alpha=.50) +
geom_polygon(data=box, fill='grey', alpha=.30) +
labs(title= paste0('e(',x,') = ', this.ex.char)) +
geom_line(data=boxtop, lwd=1.5, color='black',
arrow=arrow(length=unit(.10,'inches'))) +
geom_text(x=x+this.ex/2, y=1.03, size=3,label=this.ex.char)
print(G)
}
for (x in 0:100) make_ex_plot(x)
#---------------------------------------------
# Carl Schmertmann
# created 29 Sep 18
# altered 29 Sep 18
#
# visualize remaining life expectancy
#---------------------------------------------
rm(list=ls())
library(tidyverse)
graphics.off()
if (.Platform$OS.type == 'windows') windows(record=TRUE, width=8, height=8)
## California females 2015
file_name = 'CA_fltper_1x1.csv'
file_path = 'States/CA/CA_fltper_1x1.csv'
unzip(zipfile='lifetables.zip', files=file_path, junkpaths=TRUE)
df = read.csv(file_name, stringsAsFactors = FALSE) %>%
filter(Year == 2015) %>%
mutate(Age = 0:110,
lx = lx/lx[Age==0]) %>%
select(PopName:Age, lx, ex)
# add one row
extra_row = df[nrow(df),]
extra_row$Age = 111
extra_row$lx  = 0
df = rbind(df, extra_row)
file.remove(file_name)
## make plot
make_ex_plot = function(x) {
remaining_life = df %>%
mutate(lx = ifelse(Age < x, NA, lx/lx[Age==x]))
conditional_surv = df %>%
mutate(lx = ifelse(Age < x, 1, lx/lx[Age==x]))
this.ex = df$ex[df$Age == x]
this.ex.char = formatC( df$ex[df$Age == x], format='f' , digits=1)
box = expand.grid( lx=c(0,1) , Age=c(x,x+this.ex) )[c(1,2,4,3),]
boxtop = filter(box,lx==1)
G = ggplot( data=df, aes(x=Age, y=lx)) +
geom_line(lwd=0.5, color='royalblue') +
geom_hline(yintercept = 0) +
theme_bw()
G = G +
geom_line(data=conditional_surv, col='red', lwd=1.2) +
geom_area(data=remaining_life, fill='pink', color=NA,alpha=.50) +
geom_polygon(data=box, fill='grey', alpha=.30) +
labs(title= paste0('e(',x,') = ', this.ex.char)) +
geom_line(data=boxtop, lwd=1.5, color='black',
arrow=arrow(length=unit(.05,'inches'))) +
geom_text(x=x+this.ex/2, y=1.03, size=3,label=this.ex.char)
print(G)
}
for (x in 0:100) make_ex_plot(x)
