plot( IPUMS$age2, IPUMS$Pop, pch=16, type='o',lwd=3,
ylim=range(IPUMS$Pop, WPP$Pop), col='red',
main='Nigeria 2010')
lines(WPP$age2, WPP$Pop, pch=18, col='royalblue', type='o', lwd=3)
legend(50, 2.5e7, col=c('red','royalblue'), lty=1, lwd=3,
pch=c(16,18), bty='n', legend=c('IPUMS', 'WPP'))
plot( IPUMS$age2, IPUMS$Pop, pch=16, type='o',lwd=3,
ylim=range(IPUMS$Pop, WPP$Pop), col='red',
main='Nigeria 2010', xlab='Age Group', ylab='Population')
lines(WPP$age2, WPP$Pop, pch=18, col='royalblue', type='o', lwd=3)
legend(50, 2.5e7, col=c('red','royalblue'), lty=1, lwd=3,
pch=c(16,18), bty='n', legend=c('IPUMS', 'WPP'))
0 to 4 	9,843,986.0 	9,393,290.0 	25,170.0 	19,262,446.0
5 to 9 	12,015,862.0 	10,461,122.0 	7,656.0 	22,484,640.0
10 to 14 	10,615,103.0 	9,305,112.0 	6,830.0 	19,927,045.0
15 to 19 	8,401,092.0 	7,365,768.0 	2,418.0 	15,769,278.0
20 to 24 	5,777,626.0 	6,492,864.0 	.0 	12,270,490.0
25 to 29 	4,852,249.0 	7,079,635.0 	.0 	11,931,884.0
30 to 34 	4,722,580.0 	5,909,356.0 	.0 	10,631,936.0
35 to 39 	4,123,648.0 	5,420,222.0 	.0 	9,543,870.0
40 to 44 	4,504,180.0 	4,401,611.0 	.0 	8,905,791.0
45 to 49 	3,415,721.0 	3,225,754.0 	.0 	6,641,475.0
50 to 54 	3,500,763.0 	3,157,538.0 	.0 	6,658,301.0
55 to 59 	2,153,139.0 	1,677,225.0 	.0 	3,830,364.0
60 to 64 	2,365,047.0 	1,461,442.0 	.0 	3,826,489.0
65 to 69 	1,558,999.0 	950,211.0 	789.0 	2,509,999.0
70 to 74 	1,271,176.0 	776,871.0 	.0 	2,048,047.0
75 to 79 	612,522.0 	393,143.0 	.0 	1,005,665.0
20: 80+ 	935,054.0 	610,008.0 	987.0 	1,546,049.0
library(wpp2017)
library(tidyverse)
data(pop)
Nigeria_f = filter(popF, name=='Nigeria') %>%
select(country_code:age,'2010') %>%
rename(Female='2010')
Nigeria_m = filter(popM, name=='Nigeria') %>%
select(country_code:age,'2010') %>%
rename(Male='2010')
WPP = left_join(Nigeria_f,Nigeria_m) %>%
mutate(Pop=1000*(Female+Male),
age2 = seq(0,100,5)) %>%
filter(age2 < 85)
IPUMS = read.csv(text=
'age2, Pop
0, 19262446
5, 22484640
10, 19927045
15, 15769278
20, 12270490
25, 11931884
30, 10631936
35, 9543870
40, 8905791
45, 6641475
50, 6658301
55, 3830364
60, 3826489
65, 2509999
70, 2048047
75, 1005665
80, 1546049')
graphics.off()
windows(record=TRUE)
plot( IPUMS$age2, IPUMS$Pop, pch=16, type='o',lwd=3,
ylim=range(IPUMS$Pop, WPP$Pop), col='red',
main='Nigeria 2010', xlab='Five-Year Age Group', ylab='Population')
lines(WPP$age2, WPP$Pop, pch=18, col='royalblue', type='o', lwd=3)
legend(50, 2.5e7, col=c('red','royalblue'), lty=1, lwd=3,
pch=c(16,18), bty='n', legend=c('IPUMS', 'WPP'))
pnorm(1)
setwd("~/GitHub/USA-mortality")
#---------------------------------------------
# Carl Schmertmann
# created 29 Sep 18
# altered 03 Oct 18
#
# visualize remaining life expectancy
#---------------------------------------------
# devtools::install_github('thomasp85/gganimate')
rm(list=ls())
library(tidyverse)
library(gganimate)
graphics.off()
## California females 2015
file_name = 'CA_fltper_1x1.csv'
file_path = 'States/CA/CA_fltper_1x1.csv'
unzip(zipfile='lifetables.zip', files=file_path, junkpaths=TRUE)
CA = read.csv(file_name, stringsAsFactors = FALSE) %>%
filter(Year == 2015) %>%
mutate(Age = 0:110,
lx = lx/lx[Age==0],
dx = dx/sum(dx)) %>%
select(PopName:Age, lx, dx, ex)
file.remove(file_name)
head(CA)
map(1:5, function(i) sample(0:110, 200, probs=dx))
?sample
map(1:5, function(i) sample(0:110, 200, prob=dx))
map(1:5, function(i) sample(0:110, 200, prob=CA$dx))
map(1:5, function(i) sample(0:110, 200, replace=TRUE, prob=CA$dx))
x = map(1:5, function(i) sample(0:110, 200, replace=TRUE, prob=CA$dx))
sapply(x,mean)
sapply(x,var)
x = map(1:5, function(i) sample(0:110, 100, replace=TRUE, prob=CA$dx))
x = map(1:5, function(i) sample(0:110, 200, replace=TRUE, prob=CA$dx))
sapply(x,var)
sapply(x,mean)
sqrt( sapply(x,var) )
sapply(x, function(sa) mean(sa) + c(-1.96,+1.96) * sd(sa)/sqrt(length(sa)))
sapply(x, function(sa) mean(sa) + c(-1.96,+1.96) * sd(sa)/sqrt(length(sa))) %>% round(1)
CA$dx
sum( CA$dx)
age = 0:110
sum( age * CA$dx)
sum( age * CA$dx^2)
sum( age^2 * CA$dx)
sum( age^2 * CA$dx) - 82.8811^2
sqrt(sum( age^2 * CA$dx) - 82.8811^2)
plot(age, CA$dx, type='h')
title('AGE AT DEATH, CALIFORNIA FEMALES')
curve( dnorm(x,82.88, 14.6), col='red', lwd=2, add=TRUE)
tmp
sa
ls)()
ls()
x[[2]]
plot(age, CA$dx, type='h')
curve( dnorm(x,82.88, 14.6/10), col='red', lwd=2, add=TRUE)
curve( dnorm(x,82.88, 14.6/10), col='red', lwd=2)
curve( dnorm(x,82.88, 14.6/10), col='red', lwd=2, from=0, t0=110)
curve( dnorm(x,82.88, 14.6/10), col='red', lwd=2, from=0, to=110)
plot(age, CA$dx, type='h', ylim=c(0,.26))
curve( dnorm(x,82.88, 14.6/10), col='red', lwd=2, from=0, to=110)
plot(age, CA$dx, type='h', ylim=c(0,.26))
curve( dnorm(x,82.88, 14.6/10), col='red', lwd=2, from=0, to=110, add=TRUE)
abline(v=82.9)
abline(v=82.9, lwd=3)
S = c(76.48, 72.68)
SS = 6.7244, 4.7663
SS = 6.7244, 4.7663)
SS = c(6.7244, 4.7663)
S
SS
ybar = S/25
ybar
s2 = SS/24
s2
sd_ybar = sqrt( s2/25)
sd_ybar
qnorm(.1)
1.96 * sd_ybar
1.28 * sd_ybar
ybar - 1.28 * sd_ybar
(ybar - 1.28 * sd_ybar) %>% round(3)
(ybar + 1.28 * sd_ybar) %>% round(3)
(ybar - 1.96 * sd_ybar) %>% round(3)
(ybar + 1.96 * sd_ybar) %>% round(3)
setwd("~/GitHub/USA-mortality")
#---------------------------------------------
# Carl Schmertmann
# created 16 Oct 18
# altered 16 Oct 18
#
# q(5) time series for selected states, animated
#---------------------------------------------
rm(list=ls())
library(tidyverse)
graphics.off()
if (.Platform$OS.type == 'windows') windows(record=TRUE)
#--------------------------
# Life tables are in a big (50MB) zipped file from the USMDB
# Extract the division-level, both-sex tables if necessary
need.to.build.df = !exists('state.df')
included_states = c('CO','MN','MS','SC')
if (need.to.build.df) {
file_list = paste0('States/',included_states,'/',
included_states,'_bltper_1x1.csv')
unzip(zipfile='lifetables.zip', files=file_list, junkpaths=TRUE)
state.df = data.frame()
for (this.state in included_states) {
this.file = paste0(this.state,'_bltper_1x1.csv')
this.df = read.csv(this.file, stringsAsFactors = FALSE)
this.df$Age = 0:110 # make numeric
state.df = rbind( state.df, this.df)
file.remove(this.file)
}
} # if need.to.build
state.df
dim(state.df)
head(df)
head(stare.df)
head(state.df)
child.surv.df =
state.df %>%
group_by(PopName,Year) %>%
summarize( q5 = 1-lx[Age==5]/lx[Age==0])
dim(child.surv.df)
head(child.surv.df)
child.surv.df =
state.df %>%
group_by(PopName,Year) %>%
summarize( q5 = 1000 * (1-lx[Age==5]/lx[Age==0]))
head(child.surv.df)
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line()
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
theme_bw(text=element_text(face='bold', family='consolas'))
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
theme_bw(text=element_text(face='bold'))
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
theme_bw() +
theme(text=element_text(face='bold', family='consolas'))
G
arrange(child.surv.df, Year, q5)
arrange( ungroup(child.surv.df), Year, q5)
arrange(child.surv.df, Year, q5)
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
theme_bw() +
theme(text=element_text(face='bold'))
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(Year)
G
library(gganimate)
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(Year)
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(along=Year)
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
guides(color=FALSE) +
geom_text(x=Year+2, y=q5, label=PopName) +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
guides(color=FALSE) +
geom_text(x=child.surv.df$Year+2,
y=child.surv.df$q5, label=PopName) +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
guides(color=FALSE)
G
ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
guides(color=FALSE)
ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
guides(color=FALSE)
ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2)
ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
guides(color=FALSE)
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
guides(color=FALSE) +
geom_text(x=child.surv.df$Year+2,
y=child.surv.df$q5, label=PopName) +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
guides(color=FALSE) +
geom_text(x=child.surv.df$Year+2,
y=child.surv.df$q5, label=df$PopName) +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
guides(color=FALSE) +
geom_text(x=child.surv.df$Year+2,
y=child.surv.df$q5,
label=child.surv.df$PopName) +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
scale_x_continuous(limits=c(1958,2018)) +
guides(color=FALSE) +
geom_text(x=child.surv.df$Year+2,
y=child.surv.df$q5,
label=child.surv.df$PopName) +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
movie = animate(G, fps=4)
movie
G = ggplot( data=child.surv.df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
scale_x_continuous(limits=c(1958,2018)) +
guides(color=FALSE) +
geom_text(x=child.surv.df$Year+2,
y=child.surv.df$q5,
label=child.surv.df$PopName) +
geom_text(x=2000, y=40, label=Year, size=4,hjust=0) +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
movie = animate(G, fps=5)
movie
G = ggplot( data=df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
scale_x_continuous(limits=c(1958,2018)) +
guides(color=FALSE) +
geom_text(x=df$Year+2,
y=df$q5,
label=df$PopName) +
geom_text(x=2000, y=40, label=df$Year, color='grey',
size=4,hjust=0) +
labs(title = 'Deaths before Age 5, per 1000 newborns'),
x='Year', y='1000 q(5)',
caption='Source: US Mortality Database http://usa.mortality.org') +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
G = ggplot( data=df,
aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
scale_x_continuous(limits=c(1958,2018)) +
guides(color=FALSE) +
geom_text(x=df$Year+2,
y=df$q5,
label=df$PopName) +
geom_text(x=2000, y=40, label=df$Year, color='grey',
size=4,hjust=0) +
labs(title = 'Deaths before Age 5, per 1000 newborns',
x='Year', y='1000 q(5)',
caption='Source: US Mortality Database http://usa.mortality.org') +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
G = ggplot( data=df, aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
scale_x_continuous(limits=c(1958,2018)) +
guides(color=FALSE) +
geom_text(x=df$Year+2,
y=df$q5,
label=df$PopName) +
geom_text(x=2000, y=40, label=df$Year, color='grey',
size=4,hjust=0) +
labs(title = 'Deaths before Age 5, per 1000 newborns',
x='Year', y='1000 q(5)',
caption='Source: US Mortality Database http://usa.mortality.org') +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
movie = animate(G, fps=5)
movie
G = ggplot( data=df, aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
scale_x_continuous(limits=c(1958,2018)) +
guides(color=FALSE) +
geom_text(x=df$Year+2,
y=df$q5,
label=df$PopName) +
geom_text(x=2000, y=40, label=df$Year, color='grey',
size=4,hjust=0) +
#    labs(title = 'Deaths before Age 5, per 1000 newborns',
#         x='Year', y='1000 q(5)',
#         caption='Source: US Mortality Database http://usa.mortality.org') +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
G = ggplot( data=df, aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
scale_x_continuous(limits=c(1958,2018)) +
guides(color=FALSE) +
geom_text(x=df$Year+2,
y=df$q5,
label=df$PopName) +
#    geom_text(x=2000, y=40, label=df$Year, color='grey',
#              size=4,hjust=0) +
labs(title = 'Deaths before Age 5, per 1000 newborns',
x='Year', y='1000 q(5)',
caption='Source: US Mortality Database http://usa.mortality.org') +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
G
movie = animate(G, fps=5)
source('~/GitHub/USA-mortality/state-q5.R', echo=TRUE)
movie
G = ggplot( data=df, aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
scale_x_continuous(limits=c(1958,2018)) +
guides(color=FALSE) +
geom_text(x=df$Year+2,
y=df$q5,
label=df$PopName, size=3) +
labs(title = 'Deaths before Age 5, per 1000 newborns\nMississippi, South Carolina, Colorado, and Minnesota',
x='Year', y='1000 q(5)',
caption='Source: US Mortality Database http://usa.mortality.org') +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
movie = animate(G, fps=5)
G = ggplot( data=df, aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
scale_x_continuous(limits=c(1958,2018)) +
guides(color=FALSE) +
geom_text(x=df$Year+2,
y=df$q5,
label=df$PopName, size=5) +
geom_text(x=2000, y=40, label=floor(df$Year), color='grey',
size=8,hjust=0) +
labs(title = 'Deaths before Age 5, per 1000 newborns\nMississippi, South Carolina, Colorado, and Minnesota',
x='Year', y='1000 q(5)',
caption='Source: US Mortality Database http://usa.mortality.org') +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
movie = animate(G, fps=5)
movie
floor(1928.3)
G = ggplot( data=df, aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
scale_x_continuous(limits=c(1958,2020)) +
guides(color=FALSE) +
geom_text(x=df$Year+3,
y=df$q5,
label=df$PopName, size=5) +
labs(title = 'Deaths before Age 5, per 1000 newborns\nMississippi, South Carolina, Colorado, and Minnesota',
x='Year', y='1000 q(5)',
caption='Source: US Mortality Database http://usa.mortality.org') +
theme_bw() +
theme(text=element_text(face='bold')) +
transition_reveal(id=PopName,along=Year)
movie = animate(G, fps=5)
source('~/GitHub/USA-mortality/state-q5.R', echo=TRUE)
movie
G = ggplot( data=df, aes(x=Year, y=q5, color=PopName)) +
geom_line(lwd=2) +
scale_x_continuous(limits=c(1958,2020)) +
guides(color=FALSE) +
geom_text(x=df$Year+3,
y=df$q5,
label=df$PopName, size=5) +
labs(title = 'Deaths before Age 5, per 1000 newborns\nMississippi, South Carolina, Colorado, and Minnesota',
x='Year', y='1000 q(5)',
caption='Source: US Mortality Database http://usa.mortality.org') +
theme_bw() +
theme(text=element_text(face='bold', size=12)) +
transition_reveal(id=PopName,along=Year)
movie = animate(G, fps=5)
movie
source('~/GitHub/USA-mortality/state-q5.R', echo=TRUE)
movie
